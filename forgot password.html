<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forgot Password - WebInter</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="forgot password.css">
<style>

</style>
</head>
<body>
<div class="reset-box">
  <h2>Reset Password / Update Profile</h2>
  <div id="notification" class="notification"></div>

  <div class="profile-picture">
    <img id="profileImg" src="https://via.placeholder.com/100?text=User" alt="Profile Picture">
    <label class="custom-file-input">
      <i class="fas fa-camera"></i> Upload New Photo
      <input type="file" id="fileInput" accept="image/*" style="display:none">
    </label>
  </div>

  <form id="resetForm">
    <input type="text" id="resetInput" placeholder="Email or Phone Number" required>
    <input type="date" id="dob" placeholder="Date of Birth" required>

    <input type="text" id="firstname" placeholder="First Name" readonly>
    <input type="text" id="surname" placeholder="Surname" readonly>
    <select id="country" readonly></select>
    <input type="text" id="phone" placeholder="Phone" readonly>
    <input type="text" id="gender" placeholder="Gender" readonly>

    <div class="password-container">
      <input type="password" id="newPassword" placeholder="New Password" required>
      <span class="password-toggle" id="passwordToggle"><i class="far fa-eye"></i></span>
    </div>
    <div class="password-strength-bar" id="passwordStrengthBar"></div>
    <div class="password-strength-text" id="passwordStrengthText"></div>

    <div class="password-container">
      <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
      <span class="password-toggle" id="confirmPasswordToggle"><i class="far fa-eye"></i></span>
    </div>
    <div id="passwordMatch" class="password-match"></div>

    <button type="submit">Save Changes</button>
  </form>

  <div class="links">
    <p>Remember your password? <a href="log in.html">Login</a></p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const resetForm = document.getElementById('resetForm');
  const notification = document.getElementById('notification');
  const profileImg = document.getElementById('profileImg');
  const fileInput = document.getElementById('fileInput');
  const newPasswordInput = document.getElementById('newPassword');
  const confirmPasswordInput = document.getElementById('confirmPassword');
  const passwordToggle = document.getElementById('passwordToggle');
  const confirmPasswordToggle = document.getElementById('confirmPasswordToggle');
  const strengthBar = document.getElementById('passwordStrengthBar');
  const strengthText = document.getElementById('passwordStrengthText');
  const passwordMatch = document.getElementById('passwordMatch');
  const resetInput = document.getElementById('resetInput');
  const dobInput = document.getElementById('dob');

  const firstnameInput = document.getElementById('firstname');
  const surnameInput = document.getElementById('surname');
  const countrySelect = document.getElementById('country');
  const phoneInput = document.getElementById('phone');
  const genderInput = document.getElementById('gender');

  const countryOptions = ["Algeria","Argentina","Australia","Brazil","Canada","China","Egypt","France","Germany","Ghana","India","Japan","Kenya","Malawi","Morocco","Mozambique","Nigeria","Rwanda","South Africa","Tanzania","Uganda","United Kingdom","United States","Zambia","Zimbabwe"];
  countrySelect.innerHTML = countryOptions.map(c => `<option value="${c}">${c}</option>`).join('');

  let currentUserIndex = -1;

  function showNotification(message, type) {
    notification.textContent = message;
    notification.className = `notification show ${type}`;
    setTimeout(() => { notification.className = "notification"; }, 3000);
  }

  // Profile picture preview & save
  fileInput.addEventListener('change', function() {
    if (this.files && this.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        profileImg.src = e.target.result; // instant preview
        if (currentUserIndex !== -1) {
          let users = JSON.parse(localStorage.getItem('webInterUsers') || '[]');
          users[currentUserIndex].profilePicture = e.target.result; // save to localStorage
          localStorage.setItem('webInterUsers', JSON.stringify(users));
        }
      }
      reader.readAsDataURL(this.files[0]);
    }
  });

  document.querySelector('.custom-file-input').addEventListener('click', () => fileInput.click());

  // Password visibility
  passwordToggle.addEventListener('click', () => {
    newPasswordInput.type = newPasswordInput.type === 'password' ? 'text' : 'password';
    passwordToggle.innerHTML = newPasswordInput.type === 'password' ? '<i class="far fa-eye"></i>' : '<i class="far fa-eye-slash"></i>';
  });
  confirmPasswordToggle.addEventListener('click', () => {
    confirmPasswordInput.type = confirmPasswordInput.type === 'password' ? 'text' : 'password';
    confirmPasswordToggle.innerHTML = confirmPasswordInput.type === 'password' ? '<i class="far fa-eye"></i>' : '<i class="far fa-eye-slash"></i>';
  });

  // Password strength
  newPasswordInput.addEventListener('input', function() {
    const password = newPasswordInput.value;
    let strength = 0;
    if (password.length > 5) strength += 20;
    if (password.length > 8) strength += 20;
    if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) strength += 20;
    if (password.match(/[0-9]/)) strength += 20;
    if (password.match(/[!,@,#,$,%,^,&,*,?,_,~]/)) strength += 20;
    strengthBar.style.width = strength + '%';
    strengthBar.style.backgroundColor = strength<40? '#ff4d4d': strength<80? '#ffa64d': '#2eb82e';
    strengthText.textContent = strength<40? 'Weak': strength<80? 'Medium': 'Strong';
  });

  // Password match
  confirmPasswordInput.addEventListener('input', () => {
    passwordMatch.textContent = confirmPasswordInput.value === newPasswordInput.value ? 'Passwords match' : 'Passwords do not match';
    passwordMatch.style.color = confirmPasswordInput.value === newPasswordInput.value ? '#2eb82e' : '#ff4d4d';
  });

  // Auto-load profile & info
  function loadUserProfile() {
    const input = resetInput.value.trim();
    const dob = dobInput.value;
    let users = JSON.parse(localStorage.getItem('webInterUsers') || '[]');
    currentUserIndex = users.findIndex(user => (user.email === input || user.phone === input) && user.dob === dob);
    if(currentUserIndex !== -1){
      const user = users[currentUserIndex];
      profileImg.src = user.profilePicture || "https://via.placeholder.com/100?text=User";
      firstnameInput.value = user.firstName;
      surnameInput.value = user.surname;
      countrySelect.value = user.country;
      phoneInput.value = user.phone;
      genderInput.value = user.gender;
    } else {
      profileImg.src = "https://via.placeholder.com/100?text=User";
      firstnameInput.value = surnameInput.value = phoneInput.value = genderInput.value = '';
      countrySelect.value = '';
    }
  }

  resetInput.addEventListener('input', loadUserProfile);
  dobInput.addEventListener('change', loadUserProfile);

  // Reset form submit
  resetForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const newPassword = newPasswordInput.value;
    const confirmPassword = confirmPasswordInput.value;

    if(newPassword !== confirmPassword){
      showNotification("Passwords do not match!", "error");
      return;
    }

    if(currentUserIndex === -1){
      showNotification("No account found with this info!", "error");
      return;
    }

    let users = JSON.parse(localStorage.getItem('webInterUsers') || '[]');
    users[currentUserIndex].password = newPassword;
    users[currentUserIndex].profilePicture = profileImg.src;
    localStorage.setItem('webInterUsers', JSON.stringify(users));

    showNotification("Profile updated successfully! Redirecting to login...", "success");
    setTimeout(()=>{ window.location.href = "log in.html"; }, 2000);
  });
});
</script>
</body>
</html>